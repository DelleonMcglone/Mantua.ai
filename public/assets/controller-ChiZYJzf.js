const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-mOt31hP-.js","assets/events-u35NfD2A.js","assets/index-tILzMOs2.js","assets/index-Gp6S1Gtq.css","assets/index.es-6nzqs-Yk.js","assets/index-nibyPLVP.js"])))=>i.map(i=>d[i]);
import{B as W,s as K,g as X,a as A,n as D,b as y,_ as Y,c as E,d as Q,e as R,f as _,t as Z,h as H,u as O,p as ee,i as ne,v as ae,j as te,k as ie,l as S,m as ce}from"./index-tILzMOs2.js";const se=e=>e;class re extends W{constructor({body:a,error:t,url:i}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${se(i)}`,`Request body: ${K(a)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code,this.data=t.data}}const oe=-1;class de extends W{constructor(a,{code:t,docsPath:i,metaMessages:n,name:s,shortMessage:d}){super(d,{cause:a,docsPath:i,metaMessages:n||(a==null?void 0:a.metaMessages),name:s||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=s||a.name,this.code=a instanceof re?a.code:t??oe}}class F extends de{constructor(a,t){super(a,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class P extends F{constructor(a){super(a,{code:P.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class I extends F{constructor(a){super(a,{code:I.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(I,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const le="08c4b07e3ad25f1a27c14a4e8cecb6f0",x="eip155";let T=null;const U={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function we(e,a,t,i,n){var b,j,M;const s=await z(e,t,n),d=e.walletConnect;let{onDisplayUri:c}=d||{};const r=await A(t);!c&&n&&(c=N=>{const L=r.mobile.native||r.mobile.universal;if(!L){n(N);return}const J=ce(L,N).redirect;n(J)}),c&&s.events.addListener("display_uri",c);let u=d==null?void 0:d.optionalChains,l=e.chain;t==="global.safe"&&(u=V.map(y),l&&!u.includes(l)&&(l=void 0));const{chains:f,rpcMap:o}=pe({chain:l,client:e.client,optionalChains:u});await s.connect({...d!=null&&d.pairingTopic?{pairingTopic:d==null?void 0:d.pairingTopic}:{},optionalNamespaces:{[x]:{chains:f,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:o}}}),G(f.map(v=>Number(v.split(":")[1])),i);const h=((b=f[0])==null?void 0:b.split(":")[1])||1,m=D(h),p=he(s.session,"eip155:1");if(!p)throw new Error("No accounts found on provider.");const C=e.chain&&e.chain.id===m?e.chain:y(m);if(e){const v={chain:e.chain,optionalChains:(j=e.walletConnect)==null?void 0:j.optionalChains,pairingTopic:(M=e.walletConnect)==null?void 0:M.pairingTopic};i&&Q(i,t,v)}return c&&s.events.removeListener("display_uri",c),B(p,C,s,a,i,e.client,r,n)}async function ue(e,a,t){var d,c,r,u,l,f;if(!e.session)throw new Error("No session found on provider.");const i=`eip155:${a.id}`,n=R(a.id);if($(e.session,i)){e.setDefaultChain(i);return}try{await g({provider:e,payload:{method:"wallet_switchEthereumChain",params:[{chainId:n}]},chain:i,walletInfo:t}),e.setDefaultChain(i);return}catch(o){if(((o==null?void 0:o.code)??((c=(d=o==null?void 0:o.data)==null?void 0:d.originalError)==null?void 0:c.code))===4001)throw new Error("User rejected chain switch")}const s=fe(e.session);if(!s)throw new Error("No routable chain to send wallet_addEthereumChain");try{await g({provider:e,payload:{method:"wallet_addEthereumChain",params:[{chainId:n,chainName:a.name,nativeCurrency:a.nativeCurrency,rpcUrls:[a.rpc],blockExplorerUrls:[((u=(r=a.blockExplorers)==null?void 0:r[0])==null?void 0:u.url)??""]}]},chain:s,walletInfo:t})}catch(o){throw((o==null?void 0:o.code)??((f=(l=o==null?void 0:o.data)==null?void 0:l.originalError)==null?void 0:f.code))===4001?new Error("User rejected add chain"):new Error(`Add chain failed: ${(o==null?void 0:o.message)||String(o)}`)}if(await g({provider:e,payload:{method:"wallet_switchEthereumChain",params:[{chainId:n}]},chain:i,walletInfo:t}),e.setDefaultChain(i),!$(e.session,i))throw new Error("Target chain still not enabled by wallet")}function q(e){var a;return(a=e==null?void 0:e.namespaces)==null?void 0:a.eip155}function $(e,a){var i;const t=q(e);return!!((i=t==null?void 0:t.accounts)!=null&&i.some(n=>n.startsWith(`${a}:`)))}function he(e,a){var n;const t=q(e),i=(n=t==null?void 0:t.accounts)==null?void 0:n.find(s=>s.startsWith(`${a}:`));return i?i.split(":")[2]??null:null}function fe(e){var t,i,n,s;const a=q(e);return((s=(n=(i=(t=a==null?void 0:a.accounts)==null?void 0:t[0])==null?void 0:i.split(":"))==null?void 0:n.slice(0,2))==null?void 0:s.join(":"))??null}async function ge(e,a,t,i,n){var h,m,w,p,C;const s=i?await X(i,t):null,d=await A(t),c=await z(s?{chain:s.chain,client:e.client,walletConnect:{optionalChains:s.optionalChains,pairingTopic:s.pairingTopic}}:{client:e.client,walletConnect:{}},t,n);if(!c.session)throw await c.disconnect(),new Error("No wallet connect session found on provider.");const r=(w=(m=(h=c.session)==null?void 0:h.namespaces)==null?void 0:m[x])==null?void 0:w.accounts,u=(p=r==null?void 0:r[0])==null?void 0:p.split(":")[2];if(!u)throw new Error("No accounts found on provider.");const l=((C=e.chain)==null?void 0:C.id)||1,f=D(l),o=e.chain&&e.chain.id===f?e.chain:y(f);return B(u,o,c,a,i,e.client,d,n)}async function z(e,a,t){var u,l,f,o;if(T)return T;const i=await A(a),n=e.walletConnect,{UniversalProvider:s}=await Y(async()=>{const{UniversalProvider:h}=await import("./index.es-mOt31hP-.js").then(m=>m.k);return{UniversalProvider:h}},__vite__mapDeps([0,1,2,3,4,5]));let d=n==null?void 0:n.optionalChains,c=e.chain;a==="global.safe"&&(d=V.map(y),c&&!d.includes(c)&&(c=void 0));const r=await s.init({metadata:{description:((u=n==null?void 0:n.appMetadata)==null?void 0:u.description)||E().description,icons:[((l=n==null?void 0:n.appMetadata)==null?void 0:l.logoUrl)||E().logoUrl],name:((f=n==null?void 0:n.appMetadata)==null?void 0:f.name)||E().name,url:((o=n==null?void 0:n.appMetadata)==null?void 0:o.url)||E().url,redirect:{native:i.mobile.native||void 0,universal:i.mobile.universal||void 0}},projectId:(n==null?void 0:n.projectId)||le});if(r.events.setMaxListeners(Number.POSITIVE_INFINITY),a!=="walletConnect"){async function h(){var w,p,C,b;const m=((b=(C=(p=(w=r.session)==null?void 0:w.peer)==null?void 0:p.metadata)==null?void 0:C.redirect)==null?void 0:b.native)||i.mobile.native||i.mobile.universal;t&&m&&await t(m)}r.on("session_request_sent",h),r.events.addListener("disconnect",()=>{r.off("session_request_sent",h),T=null})}return T=r,r}function k({provider:e,address:a,client:t,chain:i,sessionRequestHandler:n,walletInfo:s}){return{address:_(a),async sendTransaction(c){const r=await g({provider:e,payload:{method:"eth_sendTransaction",params:[{data:c.data,from:_(a),gas:c.gas?R(c.gas):void 0,to:c.to,value:c.value?R(c.value):void 0}]},chain:`eip155:${c.chainId}`,walletInfo:s,sessionRequestHandler:n});return Z({chainId:c.chainId,client:t,contractAddress:c.to??void 0,gasPrice:c.gasPrice,transactionHash:r,walletAddress:_(a),walletType:"walletConnect"}),{transactionHash:r}},async signMessage({message:c}){const r=typeof c=="string"?H(c):c.raw instanceof Uint8Array?O(c.raw):c.raw;return g({provider:e,payload:{method:"personal_sign",params:[r,this.address]},chain:`eip155:${i.id}`,walletInfo:s,sessionRequestHandler:n})},async signTypedData(c){const r=ee(c),{domain:u,message:l,primaryType:f}=r,o={EIP712Domain:ne({domain:u}),...r.types};ae({domain:u,message:l,primaryType:f,types:o});const h=te({domain:u??{},message:l,primaryType:f,types:o});return await g({provider:e,payload:{method:"eth_signTypedData_v4",params:[this.address,h]},chain:`eip155:${i.id}`,walletInfo:s,sessionRequestHandler:n})}}}async function g(e){var r,u,l,f;const{provider:a,payload:t,chain:i,walletInfo:n,sessionRequestHandler:s}=e,d=a.request(t,i),c=((f=(l=(u=(r=a.session)==null?void 0:r.peer)==null?void 0:u.metadata)==null?void 0:l.redirect)==null?void 0:f.native)||n.mobile.native||n.mobile.universal;return s&&c&&await s(c),d}function B(e,a,t,i,n,s,d,c){const r=k({address:e,chain:a,client:s,provider:t,sessionRequestHandler:c,walletInfo:d});async function u(){t.removeListener("accountsChanged",f),t.removeListener("chainChanged",o),t.removeListener("disconnect",l),await t.disconnect(),T=null}function l(){G([],n),n==null||n.removeItem(U.lastUsedChainId),u(),i.emit("disconnect",void 0)}function f(h){if(h[0]){const m=k({address:_(h[0]),chain:a,client:s,provider:t,sessionRequestHandler:c,walletInfo:d});i.emit("accountChanged",m),i.emit("accountsChanged",h)}else l()}function o(h){const m=y(D(h));i.emit("chainChanged",m),n==null||n.setItem(U.lastUsedChainId,String(h))}return t.on("accountsChanged",f),t.on("chainChanged",o),t.on("disconnect",l),t.on("session_delete",l),[r,a,u,h=>me(t,h,d)]}async function me(e,a,t){try{await ue(e,a,t)}catch(i){const n=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(n)?new P(i):new I(i)}}function G(e,a){a==null||a.setItem(U.requestedChains,ie(e))}function pe(e){const a={},t=[];e.chain&&(a[e.chain.id]=S({chain:e.chain,client:e.client}),t.push(e.chain.id));const i=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const n of i)a[n.id]=S({chain:n,client:e.client}),t.push(n.id);return t.includes(1)||(a[1]=y(1).rpc,t.push(1)),{chains:t.map(n=>`eip155:${n}`),rpcMap:a}}const V=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{ge as autoConnectWC,we as connectWC};
