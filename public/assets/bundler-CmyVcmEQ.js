import{a as H,e as z,i as V,p as A}from"./utils-DmlJ-9bG.js";import{B as q,bF as W,bH as g,bI as Q,bJ as x,bo as N,bK as M,bG as $,bL as P,bM as K,bN as L,bO as S,bP as Z,bQ as E,bR as J,b9 as Y,aU as X,aT as ee,b6 as F,b5 as h,bS as te,b4 as ne,aQ as re,k as G}from"./index-tILzMOs2.js";import{e as R,t as se,g as ie,d as j,P as ae}from"./decodeAbiParameters-CNGCbnoP.js";import{d as oe}from"./to-serializable-transaction-BiLHjq5l.js";class ce extends q{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const v=R;function ue(t){const{abi:e,args:n=[],name:s}=t,u=W(s,{strict:!1}),a=e.filter(i=>u?i.type==="function"?se(i)===s:i.type==="event"?v(i)===s:!1:"name"in i&&i.name===s);if(a.length===0)return;if(a.length===1)return a[0];let r;for(const i of a){if(!("inputs"in i))continue;if(!n||n.length===0){if(!i.inputs||i.inputs.length===0)return i;continue}if(!i.inputs||i.inputs.length===0||i.inputs.length!==n.length)continue;if(n.every((o,f)=>{const p="inputs"in i&&i.inputs[f];return p?I(o,p):!1})){if(r&&"inputs"in r&&r.inputs){const o=C(i.inputs,r.inputs,n);if(o)throw new Q({abiItem:i,type:o[0]},{abiItem:r,type:o[1]})}r=i}}return r||a[0]}function I(t,e){const n=typeof t,s=e.type;switch(s){case"address":return g(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in e?Object.values(e.components).every((u,a)=>I(Object.values(t)[a],u)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(t)&&t.every(u=>I(u,{...e,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function C(t,e,n){for(const s in t){const u=t[s],a=e[s];if(u.type==="tuple"&&a.type==="tuple"&&"components"in u&&"components"in a)return C(u.components,a.components,n[s]);const r=[u.type,a.type];if(r.includes("address")&&r.includes("bytes20")?!0:r.includes("address")&&r.includes("string")?g(n[s],{strict:!1}):r.includes("address")&&r.includes("bytes")?g(n[s],{strict:!1}):!1)return r}}const T="/docs/contract/encodeEventTopics";function de(t){var c;const{abi:e,eventName:n,args:s}=t;let u=e[0];if(n){const o=ue({abi:e,name:n});if(!o)throw new x(n,{docsPath:T});u=o}if(u.type!=="event")throw new x(void 0,{docsPath:T});const a=N(u),r=v(a);let i=[];if(s&&"inputs"in u){const o=(c=u.inputs)==null?void 0:c.filter(p=>"indexed"in p&&p.indexed),f=Array.isArray(s)?s:Object.values(s).length>0?(o==null?void 0:o.map(p=>s[p.name]))??[]:[];f.length>0&&(i=(o==null?void 0:o.map((p,m)=>Array.isArray(f[m])?f[m].map((w,y)=>B({param:p,value:f[m][y]})):typeof f[m]<"u"&&f[m]!==null?B({param:p,value:f[m]}):null))??[])}return[r,...i]}function B({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return M($(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new ce(t.type);return ie([t],[e])}function fe(t,e){if(!g(t,{strict:!1}))throw new P({address:t});if(!g(e,{strict:!1}))throw new P({address:e});return t.toLowerCase()===e.toLowerCase()}const _="/docs/contract/decodeEventLog";function pe(t){const{abi:e,data:n,strict:s,topics:u}=t,a=s??!0,[r,...i]=u;if(!r)throw new K({docsPath:_});const c=e.find(d=>d.type==="event"&&r===v(N(d)));if(!(c&&"name"in c)||c.type!=="event")throw new L(r,{docsPath:_});const{name:o,inputs:f}=c,p=f==null?void 0:f.some(d=>!("name"in d&&d.name)),m=p?[]:{},w=f.map((d,l)=>[d,l]).filter(([d])=>"indexed"in d&&d.indexed);for(let d=0;d<w.length;d++){const[l,O]=w[d],U=i[d];if(!U)throw new S({abiItem:c,param:l});m[p?O:l.name||O]=le({param:l,value:U})}const y=f.filter(d=>!("indexed"in d&&d.indexed));if(y.length>0){if(n&&n!=="0x")try{const d=j(y,n);if(d)if(p)for(let l=0;l<f.length;l++)m[l]=m[l]??d.shift();else for(let l=0;l<y.length;l++)m[y[l].name]=d[l]}catch(d){if(a)throw d instanceof Z||d instanceof ae?new E({abiItem:c,data:n,params:y,size:J(n)}):d}else if(a)throw new E({abiItem:c,data:"0x",params:y,size:0})}return{eventName:o,args:Object.values(m).length>0?m:void 0}}function le({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(j([t],e)||[])[0]}function me(t){const{abi:e,args:n,logs:s,strict:u=!0}=t,a=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return s.map(r=>{var i;try{const c=e.find(f=>f.type==="event"&&r.topics[0]===v(f));if(!c)return null;const o=pe({...r,abi:[c],strict:u});return a&&!a.includes(o.eventName)||!ye({args:o.args,inputs:c.inputs,matchArgs:n})?null:{...o,...r}}catch(c){let o,f;if(c instanceof L)return null;if(c instanceof E||c instanceof S){if(u)return null;o=c.abiItem.name,f=(i=c.abiItem.inputs)==null?void 0:i.some(p=>!("name"in p&&p.name))}return{...r,args:f?[]:{},eventName:o}}}).filter(Boolean)}function ye(t){const{args:e,inputs:n,matchArgs:s}=t;if(!s)return!0;if(!e)return!1;function u(a,r,i){try{return a.type==="address"?fe(r,i):a.type==="string"||a.type==="bytes"?M($(r))===i:r===i}catch{return!1}}return Array.isArray(e)&&Array.isArray(s)?s.every((a,r)=>{if(a==null)return!0;const i=n[r];return i?(Array.isArray(a)?a:[a]).some(o=>u(i,o,e[r])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof s=="object"&&!Array.isArray(s)?Object.entries(s).every(([a,r])=>{if(r==null)return!0;const i=n.find(o=>o.name===a);return i?(Array.isArray(r)?r:[r]).some(o=>u(i,o,e[a])):!1}):!1}function he(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function D(t){const{signature:e}=t;let n;return he(e)?n=e:n=H(e),{abiEvent:n,hash:R(n),topics:de({abi:[n],args:t.filters})}}function be(t){const{logs:e,events:n,strict:s}=t;return me({abi:n.map(u=>u.abiEvent),logs:e,strict:s})}function ge(t,e){return e&&(t.__preparedMethod=e.preparedMethod,t.__contract=e.contract),t}function xe(t){const{contract:e,method:n,params:s,...u}=t,a=()=>(async()=>{var r,i;if(Array.isArray(n))return n;if(V(n))return A(n);if(typeof n=="function")return A(await n(e));if(typeof n=="string"&&n.startsWith("function ")){const c=H(n);if(c.type==="function")return A(c);throw new Error('"method" passed is not of type "function"')}if(e.abi&&((r=e.abi)==null?void 0:r.length)>0){const c=(i=e.abi)==null?void 0:i.find(o=>o.type==="function"&&o.name===n);if(c)return A(c)}throw new Error(`Could not resolve method "${n}".`)})();return ge({...u,chain:e.chain,client:e.client,data:async()=>{let r;return Array.isArray(n)?r=n:r=await a(),r[1].length===0?r[0]:r[0]+z(r[1],await Y(s??[])).slice(2)},to:e.address},{contract:e,preparedMethod:a})}function Pe(t){let e;return()=>(e||(e=t()),e)}function Ae(t={}){return D({filters:t,signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function ve(t={}){return D({filters:t,signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function we(t){const{receipt:e}=t,n={...e,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,status:e.status,to:e.to?e.to:null,transactionHash:e.transactionHash,transactionIndex:e.transactionIndex,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce),receipt:n,userOpHash:t.userOpHash}}const Te=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296)),u=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|s<<BigInt(64)|u<<BigInt(32)|a};function k(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,n==null||X(n)?n:ee(n)]))}async function Be(t){return b({...t,operation:"eth_sendUserOperation",params:[k(t.userOp),t.options.entrypointAddress??F]})}async function _e(t,e){const n=await b({...t,operation:"eth_estimateUserOperationGas",params:[k(t.userOp),t.options.entrypointAddress??F,e??{}]});return{callGasLimit:h(n.callGasLimit)+te,paymasterPostOpGasLimit:n.paymasterPostOpGasLimit!==void 0?h(n.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:n.paymasterVerificationGasLimit!==void 0?h(n.paymasterVerificationGasLimit):void 0,preVerificationGas:h(n.preVerificationGas),verificationGas:n.verificationGas!==void 0?h(n.verificationGas):void 0,verificationGasLimit:h(n.verificationGasLimit)}}async function He(t){const e=await b({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxFeePerGas:h(e.maxFeePerGas),maxPriorityFeePerGas:h(e.maxPriorityFeePerGas)}}async function Ne(t){var n,s;const e=await Ee(t);if(e){if(e.success===!1){const a=(s=(n=be({events:[Ae(),ve()],logs:e.logs})[0])==null?void 0:n.args)==null?void 0:s.revertReason;if(!a)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const r=oe({data:a});throw new Error(`UserOp failed with reason: '${r.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Ee(t){const e=await b({operation:"eth_getUserOperationReceipt",options:t,params:[t.userOpHash]});if(e)return we(e)}async function Me(t){const e=await b({operation:"zk_paymasterData",options:t.options,params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function $e(t){const e=await b({...t,operation:"tw_execute",params:[t.eoaAddress,t.wrappedCalls,t.signature,t.authorization]});if(!e.queueId)throw new Error(`Error executing 7702 transaction: ${G(e)}`);return{transactionId:e.queueId}}async function Le(t){return{transactionHash:(await b({...t,operation:"tw_getTransactionHash",params:[t.transactionId]})).transactionHash}}async function Se(t){return{transactionHash:(await b({operation:"zk_broadcastTransaction",options:t.options,params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function b(t){const{options:e,operation:n,params:s}=t,u=e.bundlerUrl??ne(e.chain),r=await re(e.client)(u,{useAuthToken:!0,body:G({id:1,jsonrpc:"2.0",method:n,params:s}),headers:{"Content-Type":"application/json"},method:"POST"}),i=await r.json();if(!r.ok||i.error){let c=i.error||r.statusText;typeof c=="object"&&(c=G(c));const o=i.code||"UNKNOWN";throw new Error(`${n} error: ${c}
Status: ${r.status}
Code: ${o}`)}return i.result}export{He as a,Te as b,Me as c,Se as d,_e as e,Be as f,Ne as g,k as h,$e as i,Le as j,Pe as o,xe as p};
